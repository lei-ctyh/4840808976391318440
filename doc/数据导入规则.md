# 数据导入规则文档

## 1. 领导看板数据导入规则

### 1.1 固定字段定义

以下字段为Excel表中的固定字段，系统会根据表头名称自动识别字段位置：

| 字段名 | 表头名称（可能的变体） | 数据类型 | 是否必填 | 格式要求 | 示例 |
|--------|----------------------|----------|----------|----------|------|
| person_id | 人员编号/编号/ID | BIGINT | 是 | 数字，最大19位 | 10001 |
| person_name | 姓名/人员姓名/名称 | VARCHAR(50) | 是 | 中文姓名，最大50字符 | 张三 |
| unit_id | 单位编号/单位ID/机构编号 | BIGINT | 否 | 数字，最大19位 | 200 |
| birth_date | 出生年月/出生日期/生日 | DATE | 否 | YYYY-MM-DD 或 YYYY-MM | 1980-05-20 |
| age | 年龄 | INT | 否 | 整数，0-150 | 45 |
| title | 衔级/职务/岗位 | VARCHAR(50) | 否 | 衔级名称，最大50字符 | 高级工程师 |
| period | 评定周期/考核周期/周期 | VARCHAR(32) | 是 | 评定周期格式 | 2025年度 |
| total_score | 总成绩/总分/综合成绩 | DECIMAL(10,2) | 否 | 数字，最多10位整数2位小数 | 89.50 |
| total_rating | 总评定/总评级/综合评定 | VARCHAR(20) | 否 | 四级制评定 | 优秀 |

### 1.2 动态指标字段映射

除了上述固定字段外，Excel表中的其他列将按照以下规则映射到指标字段：

- **系统按照Excel列的实际位置进行映射**
- **A列对应 `metric_001`，B列对应 `metric_002`，C列对应 `metric_003`，以此类推**
- **如果某列被识别为固定字段，则该列不会映射到metric字段**
- **例如：如果固定字段占用了A、C、E、G列，那么B列对应 `metric_002`，D列对应 `metric_004`，F列对应 `metric_006`，H列对应 `metric_008`，以此类推**
- **最多支持100个指标字段（对应Excel的A列到CV列）**

### 1.3 字段识别规则

#### 1.3.1 表头匹配优先级
系统按以下优先级匹配表头名称：
1. **精确匹配**：表头名称与字段名完全一致
2. **包含匹配**：表头名称包含关键词（如"人员编号"包含"编号"）
3. **模糊匹配**：表头名称与预设的变体名称匹配

#### 1.3.2 字段识别注意事项
- 表头名称不区分大小写
- 忽略表头中的空格和特殊符号
- 如果同一个固定字段有多个可能的列匹配，系统会选择最左边的列
- 未识别为固定字段的列将按从左到右的顺序映射为指标字段

### 1.4 字段格式要求

#### 1.4.1 必填字段验证
- `person_id`：不能为空，必须为正整数
- `person_name`：不能为空，不能包含特殊字符
- `period`：不能为空，建议格式为"YYYY年度"

#### 1.4.2 日期格式
- `birth_date`：支持以下格式
  - YYYY-MM-DD（如：1980-05-20）
  - YYYY-MM（如：1980-05）
  - YYYY/MM/DD（如：1980/05/20）

#### 1.4.3 数值格式
- `total_score`：0-100之间的数值，支持小数点后2位
- `metric_xxx`：数值类型，支持小数点后2位
- `age`：0-150之间的整数

#### 1.4.4 评定等级
- `total_rating`：只能是以下值之一
  - 优秀
  - 良好
  - 合格
  - 不合格

### 1.5 机构编码规则

根据系统机构编码规则，`unit_id`应遵循以下规范：

- **00开头**：领导班子
  - 00XX：领导班子下的部门
  - 00XXXX：领导班子下的科
- **01开头**：教学组织
  - 01XX：教学组织下的系
  - 01XXXX：教学组织下的班
  - 01XXXXXX：教学组织下的组

### 1.6 Excel模板示例

**示例1：固定字段在前，指标字段在后**
```
| 人员编号 | 姓名 | 单位编号 | 出生年月 | 年龄 | 衔级 | 评定周期 | 总成绩 | 总评定 | 基本知识 | 体育成绩 | 共同A | 共同B | ... |
|---------|------|----------|----------|------|------|----------|--------|--------|----------|----------|-------|-------|-----|
| 10001   | 张三 | 200      | 1980-05  | 45   | 高级工程师 | 2025年度 | 89.50  | 良好   | 90.00    | 88.00    | 85.50 | 92.00 | ... |
| 10002   | 李四 | 201      | 1975-08  | 50   | 正高级   | 2025年度 | 92.30  | 优秀   | 95.00    | 89.60    | 90.00 | 94.50 | ... |
```
*在此示例中：基本知识（J列）→metric_010，体育成绩（K列）→metric_011，共同A（L列）→metric_012，共同B（M列）→metric_013*

**示例2：固定字段与指标字段混合排列**
```
| 人员编号 | 基本知识 | 姓名 | 体育成绩 | 单位编号 | 共同A | 出生年月 | 年龄 | 衔级 | 共同B | 评定周期 | 总成绩 | 总评定 | ... |
|---------|----------|------|----------|----------|-------|----------|------|------|-------|----------|--------|--------|-----|
| 10001   | 90.00    | 张三 | 88.00    | 200      | 85.50 | 1980-05  | 45   | 高级工程师 | 92.00 | 2025年度 | 89.50  | 良好   | ... |
| 10002   | 95.00    | 李四 | 89.60    | 201      | 90.00 | 1975-08  | 50   | 正高级   | 94.50 | 2025年度 | 92.30  | 优秀   | ... |
```
*在此示例中：基本知识（B列）→metric_002，体育成绩（D列）→metric_004，共同A（F列）→metric_006，共同B（J列）→metric_010*

## 2. 数据验证规则

### 2.1 数据完整性检查
1. 检查必填字段是否为空
2. 检查数据类型是否匹配
3. 检查数值范围是否合理
4. 检查日期格式是否正确

### 2.2 业务逻辑验证
1. 同一人员在同一评定周期内不能重复导入
2. 年龄与出生年月应该匹配
3. 总评定与总成绩应该对应：
   - 90分以上：优秀
   - 80-89分：良好
   - 60-79分：合格
   - 60分以下：不合格

### 2.3 错误处理
1. **数据格式错误**：记录错误行号和具体错误信息
2. **重复数据**：提示重复的人员编号和评定周期
3. **缺失必填字段**：列出所有缺失字段的行号
4. **数值超出范围**：提示具体的超出范围字段

## 3. 导入流程

### 3.1 导入前准备
1. 确保Excel文件格式为.xlsx或.xls
2. 第一行为表头，从第二行开始为数据
3. 删除空行和无效数据
4. 检查字符编码（建议UTF-8）

### 3.2 导入步骤
1. 上传Excel文件
2. 系统自动解析文件结构
3. 验证数据格式和完整性
4. 显示验证结果和错误信息
5. 确认无误后执行导入
6. 返回导入结果统计

### 3.3 导入结果
- 成功导入记录数
- 失败记录数及详细错误信息
- 重复记录处理结果
- 数据质量报告

## 4. 注意事项

1. **文件大小限制**：单次导入文件不超过10MB
2. **数据量限制**：单次导入不超过5000条记录
3. **并发限制**：同一用户同时只能进行一个导入任务
4. **数据备份**：导入前系统会自动备份现有数据
5. **权限控制**：只有具备相应权限的用户才能执行导入操作

## 5. 常见问题

### 5.1 导入失败常见原因
- Excel文件损坏或格式不支持
- 必填字段为空
- 数据类型不匹配
- 数值超出允许范围
- 日期格式不正确

### 5.2 数据质量建议
- 导入前先用少量数据测试
- 确保数据的一致性和准确性
- 定期清理和维护基础数据
- 建立数据质量监控机制